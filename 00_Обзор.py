"""🏠 Обзор — главная страница дашборда."""

import streamlit as st
from config import (
    TOTAL_CARDS, PCT_WITH_STORY, PCT_MAY, HALFLIFE_DAYS,
    NUM_LDA_TOPICS, DMI_GINI, SAMPLE_SIZE, AGE_GAP_RANGE,
)

st.title("🎖️ Бессмертный полк — исследовательская витрина")

st.markdown(
    """
    Интерактивный дашборд для исследователей, историков и специалистов в области
    digital humanities. Данные охватывают **~981 тыс. карточек** ветеранов Великой
    Отечественной войны, размещённых на платформе «Бессмертный полк».
    """
)

# ── Метрики ───────────────────────────────────────────────────────
c1, c2, c3, c4 = st.columns(4)
c1.metric("Карточек", f"{TOTAL_CARDS:,}".replace(",", " "))
c2.metric("С текстом", f"{PCT_WITH_STORY}%")
c3.metric("Публикаций в мае", f"{PCT_MAY}%")
c4.metric("Полураспад активности", f"{HALFLIFE_DAYS} дней")

st.divider()

# ── Ключевые находки ──────────────────────────────────────────────
st.subheader("Пять ключевых находок")

findings = [
    (
        "📅 Сезонность памяти",
        f"Более {PCT_MAY}% карточек публикуются в мае — привязка к Дню Победы "
        f"создаёт ярко выраженный «пик памяти» с полураспадом около {HALFLIFE_DAYS} дней.",
    ),
    (
        "📝 Эволюция нарративов",
        f"Выявлены 4 типа текстов (формуляр, мемуар, семейная история, смешанный) "
        f"и {NUM_LDA_TOPICS} тематических кластеров. Лексическое разнообразие (MATTR) "
        "снижается — тексты становятся всё более шаблонными.",
    ),
    (
        "🗺️ География памяти",
        "46% карточек поданы не из региона рождения ветерана — "
        "миграция XX века отражается в пространственном распределении памяти.",
    ),
    (
        "🎖️ Возрастная конвергенция",
        f"Разрыв медианного возраста между рядовыми и офицерами сокращается "
        f"с {AGE_GAP_RANGE} к 1945 году — война уравнивала поколения.",
    ),
    (
        "📊 Неравенство документирования",
        f"Индекс цифровой памяти (DMI) распределён неравномерно: Gini = {DMI_GINI}. "
        "Регионы с большим объёмом карточек чаще имеют менее детальные записи.",
    ),
]

for title, text in findings:
    st.markdown(f"**{title}**")
    st.markdown(text)

st.divider()

# ── Навигация ─────────────────────────────────────────────────────
st.subheader("Разделы дашборда")

nav_items = [
    ("📈", "Динамика", "Временные ряды публикаций, сезонность, полураспад активности."),
    ("📝", "Тексты", "Типы нарративов, тональность, лексическое разнообразие, тематическое моделирование, NER."),
    ("🗺️", "География", "Матрица миграции, межрегиональные связи, локальная vs. мигрировавшая память."),
    ("🎖️", "Демография", "Распределение возраста по званиям, конвергенция возрастных профилей."),
    ("📊", "DMI", "Индекс цифровой памяти, корреляции, неравенство по регионам."),
    ("🔍", "Поиск", f"Полнотекстовый поиск по сэмплу {SAMPLE_SIZE // 1000}K карточек."),
]

cols = st.columns(3)
for i, (icon, title, desc) in enumerate(nav_items):
    with cols[i % 3]:
        st.markdown(f"#### {icon} {title}")
        st.caption(desc)

st.divider()

# ── Цитирование ──────────────────────────────────────────────────
st.subheader("Как цитировать")

st.code(
    'Бессмертный полк: исследовательская витрина [Электронный ресурс]. '
    '// Данные «Мой полк» (moypolk.ru), 981 467 карточек. '
    'URL: https://moypolk-explorer.streamlit.app (дата обращения: ДД.ММ.ГГГГ).',
    language=None,
)

st.caption(
    "Данные собраны из открытых источников платформы moypolk.ru. "
    "Дашборд создан в исследовательских целях."
)
